# Makefile para Sheets2Anki
# Uso: make build, make test, make clean

.PHONY: build test clean help

# Comando Python (detectar automaticamente)
PYTHON := $(shell command -v python3 2> /dev/null || echo python)

# DiretÃ³rios
BUILD_DIR := build
ANKIADDON_FILE := $(BUILD_DIR)/sheets2anki.ankiaddon

# Verificar se estamos no diretÃ³rio correto e mudar se necessÃ¡rio
ifneq ($(wildcard ../manifest.json),)
    ROOT_DIR := ..
else
    ROOT_DIR := .
endif

help: ## Mostrar esta ajuda
	@echo "ğŸš€ Sheets2Anki - Comandos DisponÃ­veis:"
	@echo "======================================"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

build: ## Criar build do add-on (.ankiaddon)
	@echo "ğŸ“¦ Criando build..."
	cd $(ROOT_DIR) && $(PYTHON) scripts/prepare_ankiweb.py
	@echo "âœ… Build criado: $(ROOT_DIR)/$(ANKIADDON_FILE)"

test: ## Executar todos os testes
	@echo "ğŸ§ª Executando testes..."
	cd $(ROOT_DIR) && $(PYTHON) run_tests.py

build-quick: ## Criar build sem executar testes
	@echo "âš¡ Build rÃ¡pido (sem testes)..."
	cd $(ROOT_DIR) && $(PYTHON) scripts/prepare_ankiweb.py
	@echo "âœ… Build criado: $(ROOT_DIR)/$(ANKIADDON_FILE)"

clean: ## Limpar arquivos de build
	@echo "ğŸ§¹ Limpando build..."
	rm -rf $(ROOT_DIR)/$(BUILD_DIR)
	@echo "âœ… Build limpo"

install-dev: ## Instalar dependÃªncias de desenvolvimento
	@echo "ğŸ“¥ Instalando dependÃªncias..."
	cd $(ROOT_DIR) && pip install -r requirements-dev.txt || echo "âš ï¸  requirements-dev.txt nÃ£o encontrado"

check: ## Verificar estrutura do projeto
	@echo "ğŸ” Verificando estrutura..."
	@[ -f $(ROOT_DIR)/manifest.json ] && echo "âœ“ manifest.json" || echo "âŒ manifest.json nÃ£o encontrado"
	@[ -f $(ROOT_DIR)/config.json ] && echo "âœ“ config.json" || echo "âŒ config.json nÃ£o encontrado"
	@[ -f $(ROOT_DIR)/__init__.py ] && echo "âœ“ __init__.py" || echo "âŒ __init__.py nÃ£o encontrado"
	@[ -d $(ROOT_DIR)/src ] && echo "âœ“ src/" || echo "âŒ src/ nÃ£o encontrado"
	@[ -d $(ROOT_DIR)/libs ] && echo "âœ“ libs/" || echo "âŒ libs/ nÃ£o encontrado"

all: clean test build ## Limpar, testar e criar build completo

# Alvo padrÃ£o
.DEFAULT_GOAL := help
